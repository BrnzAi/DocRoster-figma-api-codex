<ng-container *ngIf="visibleResults() as results">
  <section class="search-screen">
    <div class="search-screen__layer">
      <header class="search-screen__toolbar">
        <form class="search-bar" (submit)="$event.preventDefault()">
          <span class="search-bar__icon" aria-hidden="true">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none">
              <path
                d="M2.60585 1.75H11.4046L6.99645 7.2625L2.60585 1.75ZM0.186186 1.40875C1.96354 3.675 5.24549 7.875 5.24549 7.875V13.125C5.24549 13.6062 5.64144 14 6.12537 14H7.88513C8.36906 14 8.76501 13.6062 8.76501 13.125V7.875C8.76501 7.875 12.0382 3.675 13.8155 1.40875C13.9164 1.27958 13.9787 1.12484 13.9954 0.962156C14.0122 0.799473 13.9826 0.635385 13.9102 0.488575C13.8378 0.341764 13.7253 0.218132 13.5857 0.131754C13.4461 0.0453773 13.2849 -0.000273031 13.1204 1.22854e-06H0.88129C0.150991 1.22854e-06 -0.262552 0.831251 0.186186 1.40875Z"
                fill="#0A1748"
              />
            </svg>
          </span>
          <input
            type="search"
            [formControl]="searchControl"
            class="search-bar__input"
            placeholder="Find a specialist..."
            aria-label="Search specialists"
          />
          <button
            type="button"
            class="search-bar__trigger"
            (click)="openFilters()"
            [class.is-active]="hasActiveFilters()"
            aria-label="Filter specialists"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
              <path
                d="M12.3374 11.2933L15.5 14.4552L14.4552 15.5L11.2933 12.3374C10.1168 13.2805 8.65349 13.7935 7.14566 13.7913C3.47726 13.7913 0.5 10.8141 0.5 7.14566C0.5 3.47726 3.47726 0.5 7.14566 0.5C10.8141 0.5 13.7913 3.47726 13.7913 7.14566C13.7935 8.65349 13.2805 10.1168 12.3374 11.2933ZM10.8562 10.7454C11.7931 9.78156 12.3164 8.48984 12.3145 7.14566C12.3145 4.29024 10.0011 1.97681 7.14566 1.97681C4.29024 1.97681 1.97681 4.29024 1.97681 7.14566C1.97681 10.0011 4.29024 12.3145 7.14566 12.3145C8.48984 12.3164 9.78156 11.7931 10.7454 10.8562L10.8562 10.7454Z"
                fill="#0A1748"
              />
            </svg>
          </button>
        </form>

        <a class="search-profile" routerLink="/profile">
          <span class="search-profile__icon" aria-hidden="true">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
              <path
                d="M9 1.5C4.86 1.5 1.5 4.86 1.5 9C1.5 13.14 4.86 16.5 9 16.5C13.14 16.5 16.5 13.14 16.5 9C16.5 4.86 13.14 1.5 9 1.5ZM5.5125 13.875C6.495 13.17 7.695 12.75 9 12.75C10.305 12.75 11.505 13.17 12.4875 13.875C11.505 14.58 10.305 15 9 15C7.695 15 6.495 14.58 5.5125 13.875ZM13.605 12.84C12.2911 11.8097 10.6697 11.2497 9 11.2497C7.33032 11.2497 5.70887 11.8097 4.395 12.84C3.49286 11.7639 2.99892 10.4042 3 9C3 5.685 5.685 3 9 3C12.315 3 15 5.685 15 9C15 10.4625 14.475 11.7975 13.605 12.84Z"
                fill="#0A1748"
              />
              <path
                d="M9 4.5C7.5525 4.5 6.375 5.6775 6.375 7.125C6.375 8.5725 7.5525 9.75 9 9.75C10.4475 9.75 11.625 8.5725 11.625 7.125C11.625 5.6775 10.4475 4.5 9 4.5ZM9 8.25C8.3775 8.25 7.875 7.7475 7.875 7.125C7.875 6.5025 8.3775 6 9 6C9.6225 6 10.125 6.5025 10.125 7.125C10.125 7.7475 9.6225 8.25 9 8.25Z"
                fill="#0A1748"
              />
            </svg>
          </span>
          <span class="search-profile__label">Profile</span>
        </a>
      </header>

      <section class="search-headline" aria-labelledby="search-headline-label">
        <p id="search-headline-label" class="search-headline__label">SEARCH RESULTS FOR</p>
        <p class="search-headline__query">{{ searchControl.value ? searchControl.value : defaultPrompt }}</p>
        <p class="search-headline__count">{{ results.length }} specialists</p>
      </section>

      <section class="search-stack" [class.search-stack--empty]="!results.length">
        <ng-container *ngIf="results.length; else emptyList">
          <article
            *ngFor="let result of results; trackBy: trackByDoctor"
            class="search-row"
            [class.is-active]="mapState.activeDoctorId() === result.doctor.id"
            (mouseenter)="setActiveDoctor(result.doctor.id)"
            (focusin)="setActiveDoctor(result.doctor.id)"
            tabIndex="0"
          >
            <button type="button" class="search-row__body" (click)="openDoctor(result.doctor.id)">
              <img class="search-row__avatar" [src]="result.doctor.avatarUrl" [alt]="result.doctor.name" />
              <div class="search-row__details">
                <h2 class="search-row__name">{{ result.doctor.name }}</h2>
                <p class="search-row__meta">
                  {{ result.doctor.specialty }}
                  <ng-container *ngIf="formatDoctorFee(result.doctor.feeTier) as fee">, fee {{ fee }}</ng-container>
                </p>
                <p class="search-row__clinic">{{ result.clinic.name }}</p>
                <p class="search-row__address">
                  {{ result.clinic.address.street }}, {{ result.clinic.address.city }}, {{ result.clinic.address.state }}
                </p>
              </div>
              <span class="search-row__chevron" aria-hidden="true"></span>
            </button>
          </article>
        </ng-container>
        <ng-template #emptyList>
          <p class="search-stack__empty">No specialists match the current filters.</p>
        </ng-template>
      </section>
    </div>
  </section>

  <div class="search-filters" *ngIf="showFilters()">
    <div
      class="search-filters__backdrop"
      role="button"
      tabindex="0"
      aria-label="Close filters"
      (click)="closeFilters()"
      (keydown.enter)="closeFilters()"
      (keydown.space)="closeFilters()"
    ></div>
    <article
      class="search-filters__card"
      role="dialog"
      aria-modal="true"
      aria-label="Filter specialists"
      (click)="$event.stopPropagation()"
    >
      <p class="search-filters__label">Filters</p>
      <header class="search-filters__header">
        <h2>Filter specialists</h2>
        <div class="search-filters__actions">
          <div class="search-filters__actions-pill">
            <button
              type="button"
              class="search-filters__action search-filters__action--apply"
              (click)="applyFilters()"
              aria-label="Apply filters"
            ></button>
            <button
              type="button"
              class="search-filters__action search-filters__action--reset"
              (click)="resetFilters()"
              aria-label="Reset filters"
            ></button>
          </div>
          <button
            type="button"
            class="search-filters__action search-filters__action--close"
            (click)="closeFilters()"
            aria-label="Close filters"
          ></button>
        </div>
      </header>

      <div class="search-filters__body">
        <section class="search-filters__group">
          <h3>Sorting</h3>
          <div class="search-filters__options">
            <button
              type="button"
              class="search-filters__option"
              *ngFor="let option of sortingOptions"
              (click)="selectSorting(option.id)"
              [class.is-active]="isSortingActive(option.id)"
            >
              {{ option.label }}
            </button>
          </div>
        </section>

        <section class="search-filters__group">
          <h3>Fees</h3>
          <div class="search-filters__options">
            <button
              type="button"
              class="search-filters__option"
              *ngFor="let option of feeOptions"
              (click)="toggleFee(option.id)"
              [class.is-active]="isFeeActive(option.id)"
            >
              {{ option.label }}
            </button>
          </div>
        </section>

        <section class="search-filters__group">
          <h3>Gender</h3>
          <div class="search-filters__options">
            <button
              type="button"
              class="search-filters__option"
              *ngFor="let option of genderOptions"
              (click)="selectGender(option.id)"
              [class.is-active]="isGenderActive(option.id)"
            >
              {{ option.label }}
            </button>
          </div>
        </section>

        <section class="search-filters__group">
          <h3>Location</h3>
          <div class="search-filters__options">
            <button
              type="button"
              class="search-filters__option"
              *ngFor="let option of locationOptions"
              (click)="toggleLocation(option.id)"
              [class.is-active]="isLocationActive(option.id)"
            >
              {{ option.label }}
            </button>
          </div>
        </section>

        <section class="search-filters__group">
          <h3>Type</h3>
          <div class="search-filters__options">
            <button
              type="button"
              class="search-filters__option"
              *ngFor="let option of careOptions"
              (click)="toggleCare(option.id)"
              [class.is-active]="isCareActive(option.id)"
            >
              {{ option.label }}
            </button>
          </div>
        </section>
      </div>
    </article>
  </div>
</ng-container>
